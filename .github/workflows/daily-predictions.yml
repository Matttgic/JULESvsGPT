# .github/workflows/daily-predictions.yml
name: Daily Football Predictions

on:
  schedule:
    - cron: '0 6 * * *'  # Tous les jours √† 6h UTC (avant les matchs)
  workflow_dispatch:  # Permet de lancer manuellement

jobs:
  generate-predictions:
    runs-on: ubuntu-latest
    
    steps:
    # √âtape 1: Checkout du code
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    # √âtape 2: Configuration de Python
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    # √âtape 3: Installation des d√©pendances
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests pandas streamlit sqlalchemy python-dotenv
    
    # √âtape 4: Cr√©ation du dossier pour les pr√©dictions
    - name: Create predictions directory
      run: mkdir -p data/predictions
    
    # √âtape 5: G√©n√©ration des pr√©dictions quotidiennes
    - name: Generate daily predictions
      env:
        RAPIDAPI_KEY: ${{ secrets.RAPIDAPI_KEY }}
      run: |
        python daily_predictions_generator.py
    
    # √âtape 6: Commit et push des fichiers de pr√©dictions
    - name: Commit and push predictions
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # Ajouter seulement les fichiers CSV (pas les logs)
        git add data/predictions/*.csv 2>/dev/null || echo "Aucun fichier CSV √† ajouter"
        
        # V√©rifier s'il y a des changements √† committer
        if git diff --staged --quiet; then
          echo "‚úÖ Aucune nouvelle pr√©diction √† sauvegarder"
        else
          git commit -m "üîÆ Pr√©dictions quotidiennes - $(date '+%Y-%m-%d')"
          git push
          echo "‚úÖ Pr√©dictions sauvegard√©es"
        fi
    
    # √âtape 7: Upload des logs en cas d'erreur
    - name: Upload logs on failure
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: predictions-logs
        path: daily_predictions.log
    
    # √âtape 8: R√©sum√©
    - name: Display summary
      run: |
        echo "=== R√âSUM√â DES PR√âDICTIONS ==="
        echo "Date: $(date)"
        echo "Fichiers g√©n√©r√©s:"
        ls -la data/predictions/ || echo "Aucun fichier de pr√©diction"
        echo ""
        echo "Derni√®res lignes du log:"
        tail -10 daily_predictions.log 2>/dev/null || echo "Aucun log trouv√©"
